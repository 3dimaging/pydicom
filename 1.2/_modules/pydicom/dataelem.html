

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pydicom.dataelem &mdash; pydicom 1.2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/pydicom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/pydicom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> pydicom
          

          
            
            <img src="../../_static/pydicom_flat_black.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started with pydicom</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pydicom_user_guide.html">Pydicom User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ref_guide.html">Reading and writing DICOM files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_ref.html">Pydicom Complete API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/index.html">General examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/index.html#image-processing">Image processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/index.html#input-output">Input-output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/index.html#metadata-processing">Metadata processing</a></li>
</ul>
<p class="caption"><span class="caption-text">Additional Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release history</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pydicom</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pydicom.dataelem</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pydicom.dataelem</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2008-2018 pydicom authors. See LICENSE file for details.</span>
<span class="sd">&quot;&quot;&quot;Define the DataElement class.</span>

<span class="sd">A DataElement has a tag,</span>
<span class="sd">              a value representation (VR),</span>
<span class="sd">              a value multiplicity (VM)</span>
<span class="sd">              and a value.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">pydicom</span> <span class="k">import</span> <span class="n">config</span>  <span class="c1"># don&#39;t import datetime_conversion directly</span>
<span class="kn">from</span> <span class="nn">pydicom</span> <span class="k">import</span> <span class="n">compat</span>
<span class="kn">from</span> <span class="nn">pydicom.charset</span> <span class="k">import</span> <span class="n">default_encoding</span>
<span class="kn">from</span> <span class="nn">pydicom.compat</span> <span class="k">import</span> <span class="n">in_py2</span>
<span class="kn">from</span> <span class="nn">pydicom.datadict</span> <span class="k">import</span> <span class="p">(</span><span class="n">dictionary_has_tag</span><span class="p">,</span> <span class="n">dictionary_description</span><span class="p">,</span>
                              <span class="n">dictionary_keyword</span><span class="p">,</span> <span class="n">dictionary_is_retired</span><span class="p">,</span>
                              <span class="n">private_dictionary_description</span><span class="p">,</span> <span class="n">dictionary_VR</span><span class="p">,</span>
                              <span class="n">repeater_has_tag</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pydicom.multival</span> <span class="k">import</span> <span class="n">MultiValue</span>
<span class="kn">from</span> <span class="nn">pydicom.tag</span> <span class="k">import</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">BaseTag</span>
<span class="kn">from</span> <span class="nn">pydicom.uid</span> <span class="k">import</span> <span class="n">UID</span>
<span class="kn">import</span> <span class="nn">pydicom.valuerep</span>  <span class="c1"># don&#39;t import DS directly as can be changed by config</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">in_py2</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pydicom.valuerep</span> <span class="k">import</span> <span class="n">PersonName3</span> <span class="k">as</span> <span class="n">PersonNameUnicode</span>
    <span class="n">PersonName</span> <span class="o">=</span> <span class="n">PersonNameUnicode</span>


<span class="c1"># Helper functions:</span>
<div class="viewcode-block" id="isMultiValue"><a class="viewcode-back" href="../../api_ref.html#pydicom.dataelem.isMultiValue">[docs]</a><span class="k">def</span> <span class="nf">isMultiValue</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True if `value` is list-like (iterable),</span>
<span class="sd">       False otherwise.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">compat</span><span class="o">.</span><span class="n">char_types</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">iter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="isString"><a class="viewcode-back" href="../../api_ref.html#pydicom.dataelem.isString">[docs]</a><span class="k">def</span> <span class="nf">isString</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True if `val` is string-like,</span>
<span class="sd">       False otherwise.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">compat</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_is_bytes</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True only in Python 3 if `val` is of type `bytes`.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">in_py2</span> <span class="k">else</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>


<div class="viewcode-block" id="isStringOrStringList"><a class="viewcode-back" href="../../api_ref.html#pydicom.dataelem.isStringOrStringList">[docs]</a><span class="k">def</span> <span class="nf">isStringOrStringList</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True if `val` is a str or an iterable</span>
<span class="sd">       containing only strings.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">isMultiValue</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># single value - test for a string</span>
        <span class="k">return</span> <span class="n">isString</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></div>


<span class="c1"># double &#39;\&#39; because it is used as escape chr in Python</span>
<span class="n">_backslash_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span>
<span class="n">_backslash_byte</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span>


<div class="viewcode-block" id="DataElement"><a class="viewcode-back" href="../../api_ref.html#pydicom.dataelem.DataElement">[docs]</a><span class="k">class</span> <span class="nc">DataElement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Contain and manipulate a DICOM Element.</span>

<span class="sd">    While its possible to create a new DataElement</span>
<span class="sd">    directly and add it to a Dataset:</span>

<span class="sd">    &gt;&gt;&gt; elem = DataElement(0x00100010, &#39;PN&#39;, &#39;CITIZEN^Joan&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ds = Dataset()</span>
<span class="sd">    &gt;&gt;&gt; ds.add(elem)</span>

<span class="sd">    Its far more convenient to use a Dataset to add a new</span>
<span class="sd">    DataElement, as the VR and tag are determined</span>
<span class="sd">    automatically from the DICOM dictionary:</span>

<span class="sd">    &gt;&gt;&gt; ds = Dataset()</span>
<span class="sd">    &gt;&gt;&gt; ds.PatientName = &#39;CITIZEN^Joan&#39;</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    descripWidth : int</span>
<span class="sd">        For string display, this is the maximum width of</span>
<span class="sd">        the description field (default 35 characters).</span>
<span class="sd">    file_tell : int or None</span>
<span class="sd">    is_retired : bool</span>
<span class="sd">        For officially registered DICOM Data Elements this</span>
<span class="sd">        will be True if the retired status as given in PS3.6</span>
<span class="sd">        Table 6-1 is &#39;RET&#39;. For private or unknown Elements</span>
<span class="sd">        this will always be False</span>
<span class="sd">    is_undefined_length : bool</span>
<span class="sd">        Indicates whether the length field for the element</span>
<span class="sd">        was 0xFFFFFFFFL (ie undefined).</span>
<span class="sd">    keyword : str</span>
<span class="sd">        For officially registered DICOM Data Elements this</span>
<span class="sd">        will be the Keyword as given in PS3.6 Table 6-1.</span>
<span class="sd">        For private or unknown Elements this will return</span>
<span class="sd">        an empty string.</span>
<span class="sd">    maxBytesToDisplay : int</span>
<span class="sd">        For string display, elements with values containing</span>
<span class="sd">        data which is longer than this value will display</span>
<span class="sd">        &quot;array of # bytes&quot; (default 16 bytes).</span>
<span class="sd">    name : str</span>
<span class="sd">        For officially registered DICOM Data Elements this</span>
<span class="sd">        will be the Name as given in PS3.6 Table 6-1.</span>
<span class="sd">        For private Elements known to pydicom this will be</span>
<span class="sd">        the Name in the format &#39;[name]&#39;. For unknown</span>
<span class="sd">        private Elements this will be &#39;Private Creator&#39;.</span>
<span class="sd">        For unknown Elements this will return an empty string.</span>
<span class="sd">    showVR : bool</span>
<span class="sd">        For string display, include the Element&#39;s VR</span>
<span class="sd">        just before it&#39;s `value` (default True)</span>
<span class="sd">    tag : pydicom.tag.Tag</span>
<span class="sd">        The DICOM Tag for the Data Element</span>
<span class="sd">    value</span>
<span class="sd">        The Data Element&#39;s stored value(s)</span>
<span class="sd">    VM : int</span>
<span class="sd">        The Value Multiplicity of the Data Element&#39;s</span>
<span class="sd">        stored value(s)</span>
<span class="sd">    VR : str</span>
<span class="sd">        The Data Element&#39;s Value Representation value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">descripWidth</span> <span class="o">=</span> <span class="mi">35</span>
    <span class="n">maxBytesToDisplay</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">showVR</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">is_raw</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Python 2: Classes which define __eq__</span>
    <span class="c1"># should flag themselves as unhashable</span>
    <span class="fm">__hash__</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">tag</span><span class="p">,</span>
                 <span class="n">VR</span><span class="p">,</span>
                 <span class="n">value</span><span class="p">,</span>
                 <span class="n">file_value_tell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">is_undefined_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">already_converted</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new DataElement.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tag</span>
<span class="sd">            The DICOM (group, element) tag in any form accepted by</span>
<span class="sd">            pydicom.tag.Tag such as [0x0010, 0x0010], (0x10, 0x10), 0x00100010,</span>
<span class="sd">            etc.</span>
<span class="sd">        VR : str</span>
<span class="sd">            The 2 character DICOM value representation (see DICOM standard part</span>
<span class="sd">            5, Section 6.2).</span>
<span class="sd">        value</span>
<span class="sd">            The value of the data element. One of the following:</span>
<span class="sd">            * a single string value</span>
<span class="sd">            * a number</span>
<span class="sd">            * a list or tuple with all strings or all numbers</span>
<span class="sd">            * a multi-value string with backslash separator</span>
<span class="sd">        file_value_tell : int or None</span>
<span class="sd">            Used internally by Dataset to store the write position for the</span>
<span class="sd">            ReplaceDataElementValue() method. Default is None.</span>
<span class="sd">        is_undefined_length : bool</span>
<span class="sd">            Used internally to store whether the length field for this element</span>
<span class="sd">            was 0xFFFFFFFFL, i.e. &#39;undefined length&#39;. Default is False.</span>
<span class="sd">        already_converted : bool</span>
<span class="sd">            Used to determine whether or not `value` requires conversion to a</span>
<span class="sd">            value with VM &gt; 1. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">BaseTag</span><span class="p">):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">=</span> <span class="n">VR</span>  <span class="c1"># Note!: you must set VR before setting value</span>
        <span class="k">if</span> <span class="n">already_converted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># calls property setter which will convert</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_tell</span> <span class="o">=</span> <span class="n">file_value_tell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_undefined_length</span> <span class="o">=</span> <span class="n">is_undefined_length</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the element&#39;s `value`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert (if necessary) and set the `value` of the element.&quot;&quot;&quot;</span>
        <span class="c1"># Check if is a string with multiple values separated by &#39;\&#39;</span>
        <span class="c1"># If so, turn them into a list of separate strings</span>
        <span class="c1">#  Last condition covers &#39;US or SS&#39; etc</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">compat</span><span class="o">.</span><span class="n">char_types</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="ow">not</span> <span class="ow">in</span> \
                <span class="p">[</span><span class="s1">&#39;UT&#39;</span><span class="p">,</span> <span class="s1">&#39;ST&#39;</span><span class="p">,</span> <span class="s1">&#39;LT&#39;</span><span class="p">,</span> <span class="s1">&#39;FL&#39;</span><span class="p">,</span> <span class="s1">&#39;FD&#39;</span><span class="p">,</span> <span class="s1">&#39;AT&#39;</span><span class="p">,</span> <span class="s1">&#39;OB&#39;</span><span class="p">,</span> <span class="s1">&#39;OW&#39;</span><span class="p">,</span> <span class="s1">&#39;OF&#39;</span><span class="p">,</span> <span class="s1">&#39;SL&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SQ&#39;</span><span class="p">,</span> <span class="s1">&#39;SS&#39;</span><span class="p">,</span> <span class="s1">&#39;UL&#39;</span><span class="p">,</span> <span class="s1">&#39;OB/OW&#39;</span><span class="p">,</span> <span class="s1">&#39;OW/OB&#39;</span><span class="p">,</span> <span class="s1">&#39;OB or OW&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OW or OB&#39;</span><span class="p">,</span> <span class="s1">&#39;UN&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;US&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_backslash_str</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_backslash_str</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_backslash_byte</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_backslash_byte</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">VM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value multiplicity (as an int) of the element.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">isMultiValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_convert_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert `val` to an appropriate type and return the result.</span>

<span class="sd">        Uses the element&#39;s VR in order to determine the conversion method and</span>
<span class="sd">        resulting type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="s1">&#39;SQ&#39;</span><span class="p">:</span>  <span class="c1"># a sequence - leave it alone</span>
            <span class="kn">from</span> <span class="nn">pydicom.sequence</span> <span class="k">import</span> <span class="n">Sequence</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="c1"># if the value is a list, convert each element</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span><span class="o">.</span><span class="n">append</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># not a list</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultiValue</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert `val` to an appropriate type for the element&#39;s VR.&quot;&quot;&quot;</span>

        <span class="c1"># If the value is a byte string and has a VR that can only be encoded</span>
        <span class="c1"># using the default character repertoire, we convert it to a string</span>
        <span class="c1"># here to allow for byte string input in these cases</span>
        <span class="k">if</span> <span class="n">_is_bytes</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s1">&#39;AE&#39;</span><span class="p">,</span> <span class="s1">&#39;AS&#39;</span><span class="p">,</span> <span class="s1">&#39;CS&#39;</span><span class="p">,</span> <span class="s1">&#39;DA&#39;</span><span class="p">,</span> <span class="s1">&#39;DS&#39;</span><span class="p">,</span> <span class="s1">&#39;DT&#39;</span><span class="p">,</span> <span class="s1">&#39;IS&#39;</span><span class="p">,</span> <span class="s1">&#39;TM&#39;</span><span class="p">,</span> <span class="s1">&#39;UI&#39;</span><span class="p">,</span> <span class="s1">&#39;UR&#39;</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="s1">&#39;IS&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">valuerep</span><span class="o">.</span><span class="n">IS</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="s1">&#39;DA&#39;</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">datetime_conversion</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">valuerep</span><span class="o">.</span><span class="n">DA</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="s1">&#39;DS&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">valuerep</span><span class="o">.</span><span class="n">DS</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="s1">&#39;DT&#39;</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">datetime_conversion</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">valuerep</span><span class="o">.</span><span class="n">DT</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="s1">&#39;TM&#39;</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">datetime_conversion</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">valuerep</span><span class="o">.</span><span class="n">TM</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="s2">&quot;UI&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">UID</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">in_py2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="s2">&quot;PN&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PersonName</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="c1"># Later may need this for PersonName as for UI,</span>
        <span class="c1">#    but needs more thought</span>
        <span class="c1"># elif self.VR == &quot;PN&quot;:</span>
        <span class="c1">#    return PersonName(val)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># is either a string or a type 2 optionally blank string</span>
            <span class="k">return</span> <span class="n">val</span>  <span class="c1"># this means a &quot;numeric&quot; value could be empty string &quot;&quot;</span>
        <span class="c1"># except TypeError:</span>
            <span class="c1"># print &quot;Could not convert value &#39;%s&#39; to VR &#39;%s&#39; in tag %s&quot; \</span>
            <span class="c1"># % (repr(val), self.VR, self.tag)</span>
        <span class="c1"># except ValueError:</span>
            <span class="c1"># print &quot;Could not convert value &#39;%s&#39; to VR &#39;%s&#39; in tag %s&quot; \</span>
            <span class="c1"># % (repr(val), self.VR, self.tag)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare `self` and `other` for equality.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            The result if `self` and `other` are the same class</span>
<span class="sd">        NotImplemented</span>
<span class="sd">            If `other` is not the same class as `self` then returning</span>
<span class="sd">            NotImplemented delegates the result to superclass.__eq__(subclass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Faster result if same object</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">tag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">VR</span> \
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare `self` and `other` for inequality.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return str representation of the element.&quot;&quot;&quot;</span>
        <span class="n">repVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repval</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showVR</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%-*s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">descripWidth</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">()[:</span><span class="bp">self</span><span class="o">.</span><span class="n">descripWidth</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">VR</span><span class="p">,</span> <span class="n">repVal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%-*s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">descripWidth</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">()[:</span><span class="bp">self</span><span class="o">.</span><span class="n">descripWidth</span><span class="p">],</span> <span class="n">repVal</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">repval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a str representation of the element&#39;s `value`.&quot;&quot;&quot;</span>
        <span class="n">byte_VRs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OB&#39;</span><span class="p">,</span> <span class="s1">&#39;OW&#39;</span><span class="p">,</span> <span class="s1">&#39;OW/OB&#39;</span><span class="p">,</span> <span class="s1">&#39;OW or OB&#39;</span><span class="p">,</span> <span class="s1">&#39;OB or OW&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;US or SS or OW&#39;</span><span class="p">,</span> <span class="s1">&#39;US or SS&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="ow">in</span> <span class="n">byte_VRs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBytesToDisplay</span><span class="p">):</span>
            <span class="n">repVal</span> <span class="o">=</span> <span class="s2">&quot;Array of </span><span class="si">%d</span><span class="s2"> bytes&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">UID</span><span class="p">):</span>
            <span class="n">repVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">repVal</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># will tolerate unicode too</span>
        <span class="k">return</span> <span class="n">repVal</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return unicode representation of the element.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">compat</span><span class="o">.</span><span class="n">text_type</span><span class="p">):</span>
            <span class="c1"># start with the string rep then replace the value part</span>
            <span class="c1">#   with the unicode</span>
            <span class="n">strVal</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">strVal</span> <span class="o">=</span> <span class="n">strVal</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repval</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">uniVal</span> <span class="o">=</span> <span class="n">compat</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">strVal</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
            <span class="k">return</span> <span class="n">uniVal</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">compat</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value at `key` if the element&#39;s</span>
<span class="sd">           `value` is indexable.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;DataElement value is unscriptable &quot;</span>
                            <span class="s2">&quot;(not a Sequence)&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the DICOM dictionary name for the element.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>

<div class="viewcode-block" id="DataElement.description"><a class="viewcode-back" href="../../api_ref.html#pydicom.dataelem.DataElement.description">[docs]</a>    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the DICOM dictionary name for the element.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">is_private</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Private tag data&quot;</span>  <span class="c1"># default</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;private_creator&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># If have name from private dictionary, use it, but</span>
                    <span class="c1">#   but put in square brackets so is differentiated,</span>
                    <span class="c1">#   and clear that cannot access it by name</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">private_dictionary_description</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_creator</span><span class="p">)</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">elem</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Private Creator&quot;</span>
        <span class="k">elif</span> <span class="n">dictionary_has_tag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="ow">or</span> <span class="n">repeater_has_tag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">dictionary_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>

        <span class="c1"># implied Group Length dicom versions &lt; 3</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">element</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Group Length&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">name</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_retired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The element&#39;s retired status.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dictionary_has_tag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">dictionary_is_retired</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keyword</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The element&#39;s keyword (if known).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dictionary_has_tag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">dictionary_keyword</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the representation of the element.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">==</span> <span class="s2">&quot;SQ&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="DeferredDataElement"><a class="viewcode-back" href="../../api_ref.html#pydicom.dataelem.DeferredDataElement">[docs]</a><span class="k">class</span> <span class="nc">DeferredDataElement</span><span class="p">(</span><span class="n">DataElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Subclass of DataElement where value is not read</span>
<span class="sd">       into memory until needed&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">VR</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">file_mtime</span><span class="p">,</span> <span class="n">data_element_tell</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store basic info for the data element but value</span>
<span class="sd">           will be read later</span>

<span class="sd">        fp -- DicomFile object representing the dicom file being read</span>
<span class="sd">        file_mtime -- last modification time on file, used to make sure</span>
<span class="sd">           it has not changed since original read</span>
<span class="sd">        data_element_tell -- file position at start of data element,</span>
<span class="sd">           (not the start of the value part, but start of whole element)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;DeferredDataElement is deprecated and will be removed in &quot;</span>
            <span class="s2">&quot;pydicom v1.3&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">BaseTag</span><span class="p">):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VR</span> <span class="o">=</span> <span class="n">VR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># flag as unread</span>

        <span class="c1"># Check current file object and save info needed for read later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp_is_implicit_VR</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">is_implicit_VR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp_is_little_endian</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">is_little_endian</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_mtime</span> <span class="o">=</span> <span class="n">file_mtime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_element_tell</span> <span class="o">=</span> <span class="n">data_element_tell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">repval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Deferred read: length </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataElement</span><span class="o">.</span><span class="n">repval</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get method for &#39;value&#39; property&quot;&quot;&quot;</span>
        <span class="c1"># Must now read the value if haven&#39;t already</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_value</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">DataElement</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">DataElement</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>


<span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;tag VR length value value_tell is_implicit_VR is_little_endian&#39;</span>
<span class="n">RawDataElement</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;RawDataElement&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="n">RawDataElement</span><span class="o">.</span><span class="n">is_raw</span> <span class="o">=</span> <span class="kc">True</span>


<div class="viewcode-block" id="DataElement_from_raw"><a class="viewcode-back" href="../../api_ref.html#pydicom.dataelem.DataElement_from_raw">[docs]</a><span class="k">def</span> <span class="nf">DataElement_from_raw</span><span class="p">(</span><span class="n">raw_data_element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a DataElement created from the data in `raw_data_element`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    raw_data_element : RawDataElement namedtuple</span>
<span class="sd">        The raw data to convert to a DataElement</span>
<span class="sd">    encoding : str</span>
<span class="sd">        The encoding of the raw data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pydicom.dataelem.DataElement</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># XXX buried here to avoid circular import</span>
    <span class="c1"># filereader-&gt;Dataset-&gt;convert_value-&gt;filereader</span>
    <span class="c1"># (for SQ parsing)</span>

    <span class="k">if</span> <span class="n">in_py2</span><span class="p">:</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span> <span class="ow">or</span> <span class="n">default_encoding</span>
    <span class="kn">from</span> <span class="nn">pydicom.values</span> <span class="k">import</span> <span class="n">convert_value</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">raw_data_element</span>

    <span class="c1"># If user has hooked into conversion of raw values, call his/her routine</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">data_element_callback</span><span class="p">:</span>
        <span class="n">data_elem</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">data_element_callback</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">data_elem</span><span class="p">(</span><span class="n">raw_data_element</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">config</span><span class="o">.</span><span class="n">data_element_callback_kwargs</span><span class="p">)</span>
    <span class="n">VR</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">VR</span>
    <span class="k">if</span> <span class="n">VR</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Can be if was implicit VR</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">VR</span> <span class="o">=</span> <span class="n">dictionary_VR</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># just read the bytes, no way to know what they mean</span>
            <span class="k">if</span> <span class="n">raw</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">is_private</span><span class="p">:</span>
                <span class="c1"># for VR for private tags see PS3.5, 6.2.2</span>
                <span class="k">if</span> <span class="n">raw</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">is_private_creator</span><span class="p">:</span>
                    <span class="n">VR</span> <span class="o">=</span> <span class="s1">&#39;LO&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">VR</span> <span class="o">=</span> <span class="s1">&#39;UN&#39;</span>

            <span class="c1"># group length tag implied in versions &lt; 3.0</span>
            <span class="k">elif</span> <span class="n">raw</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">element</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">VR</span> <span class="o">=</span> <span class="s1">&#39;UL&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unknown DICOM tag </span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; can&#39;t look up VR&quot;</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">convert_value</span><span class="p">(</span><span class="n">VR</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NotImplementedError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2"> in tag </span><span class="si">{1!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">raw</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">DataElement</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">VR</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">raw</span><span class="o">.</span><span class="n">value_tell</span><span class="p">,</span>
                       <span class="n">raw</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="n">already_converted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2008-2018, Darcy Mason and pydicom contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>